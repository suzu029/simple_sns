{% extends "base.html" %}

{% block content %}
  <h2>æŠ•ç¨¿ä¸€è¦§</h2>

  <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; background-color: #f9f9f9;">
    <p style="margin: 0; font-weight: bold;">å…¨æŠ•ç¨¿ã®ã„ã„ã­ç·æ•° (ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥)</p>
    <p style="margin: 5px 0 0 0;">
      GroupA: <strong>{{ total_group_a_likes }}</strong> ã„ã„ã­
      / GroupB: <strong>{{ total_group_b_likes }}</strong> ã„ã„ã­
    </p>
  </div>
  <p>
    <a href="{% url 'post_create' %}" style="text-decoration:none;">
      ğŸ“ æŠ•ç¨¿
    </a>
  </p>

  {% for post in posts %}
    <div>
      <p>
        <strong>{{ post.user.username }}</strong>
        {% if post.associated_group != 'N' %}
            <span style="font-size: small; color: green; margin-left: 10px;">
                [å¯¾è±¡: {{ post.get_associated_group_display }}]
            </span>
        {% endif %}
      </p>
      
      <p>{{ post.content }}</p>
      {% if post.image %}
        <img src="{{ post.image.url }}" width="300" 
             id="post-image-{{ post.id }}" 
             data-post-id="{{ post.id }}" 
             style="cursor: pointer;">
      {% endif %}
      <p>â¤ï¸ {{ post.total_likes }} ã„ã„ã­</p>

      <form action="{% url 'like_post' post.id %}" method="post" id="like-form-{{ post.id }}" style="display: inline;">
        {% csrf_token %}
        {% if user in post.likes.all %}
          <button type="submit">ã„ã„ã­è§£é™¤</button>
        {% else %}
          <button type="submit">ã„ã„ã­</button>
        {% endif %}
      </form>
      <hr>
    </div>
  {% endfor %}

{% if user.is_authenticated %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ã™ã¹ã¦ã®æŠ•ç¨¿ç”»åƒã‚’å–å¾—
        const postImages = document.querySelectorAll('[id^="post-image-"]');

        postImages.forEach(image => {
            image.addEventListener('dblclick', function() {
                // post-idã‚’å–å¾—
                const postId = this.getAttribute('data-post-id');
                
                if (postId) {
                    // å¯¾å¿œã™ã‚‹ã€Œã„ã„ã­ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¦‹ã¤ã‘ã¦é€ä¿¡
                    const likeForm = document.getElementById('like-form-' + postId);
                    if (likeForm) {
                        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ã¦ã€Œã„ã„ã­ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
                        likeForm.submit();
                    }
                }
            });
        });
    });
</script>
{% endif %}
{% endblock content %}